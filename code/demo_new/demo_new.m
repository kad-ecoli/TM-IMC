clc;
clear;
addpath('.\miFV');
addpath('.\IMC');
B=round(1*rand(108,60));%  Randomly generating the association matrix(108*60);
[Tr1,Tr2,Tr3,Te1,Te2,Te3] = Split(B);
Q1=[];Q2=[];Q3=[];
k=50;
lambda = 0.3;
maxiter = 100;
[X] = Mifv('.\data\GPCRfeature.txt','.\data\GPCRvector.txt',10151);
[Y] = Mifv('.\data\GOfeature.txt','.\data\GOvector.txt',2348);
n=size(Tr1,2);
W1 = randn(size(X,2), k);
 H1= randn(size(Y,2), k);
 [W, H] = IMC(Tr1, X, Y, k, lambda, maxiter, W1, H1);
 Q1=X*W'*H*Y';
 W2 = randn(size(X,2), k);
 H2 = randn(size(Y,2), k);
 [W, H] = IMC(Tr2, X, Y, k, lambda, maxiter, W2, H2);
 Q2=X*W'*H*Y';
 W3 = randn(size(X,2), k);
 H3 = randn(size(Y,2), k);
 [W, H] = IMC(Tr3, X, Y, k, lambda, maxiter, W3, H3);
Q3=X*W'*H*Y';
y1=Topr(20,Tr1,Tr2,Tr3,Te1,Te2,Te3,Q1,Q2,Q3,B);
y2=Topr(40,Tr1,Tr2,Tr3,Te1,Te2,Te3,Q1,Q2,Q3,B);
y3=Topr(60,Tr1,Tr2,Tr3,Te1,Te2,Te3,Q1,Q2,Q3,B);
y4=Topr(80,Tr1,Tr2,Tr3,Te1,Te2,Te3,Q1,Q2,Q3,B);
y5=Topr(100,Tr1,Tr2,Tr3,Te1,Te2,Te3,Q1,Q2,Q3,B);
figure(1);
x=[0;20;40;60;80;100];
y=[0;y1;y2;y3;y4;y5];
plot(x,y,'k*-','LineWidth',2);
hold on;
fprintf('The relative recovery error is: %.4f\n', (norm(Tr1-Q1,'fro')/norm(Tr1,'fro')+norm(Tr2-Q2,'fro')/norm(Tr2,'fro')+norm(Tr3-Q3,'fro')/norm(Tr3,'fro'))/3);